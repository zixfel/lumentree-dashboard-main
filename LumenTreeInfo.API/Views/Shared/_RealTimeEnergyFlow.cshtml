@* Real-Time Energy Flow Display with Advanced Visual Effects *@

<!-- Real-Time Energy Flow Display -->
<div id="realTimeFlow" class="mb-8 hidden animate-fade-in">
    <div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 p-6">
        <h2 class="text-xl font-semibold mb-6 flex items-center justify-between">
            <span class="flex items-center">
                <svg class="w-6 h-6 mr-2 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                Real-Time Energy Flow
            </span>
            <span class="text-sm text-gray-500 dark:text-gray-400 flex items-center">
                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse mr-2"></span>
                Live
            </span>
        </h2>

        <div class="relative">
            <!-- Energy Flow Grid -->
            <div class="grid grid-cols-3 gap-6">
                <!-- ROW 1: PV, Device, Grid -->
                
                <!-- PV Panel (Solar) -->
                <div class="energy-card bg-gradient-to-br from-yellow-50 to-amber-100 dark:from-yellow-900/30 dark:to-amber-800/30 rounded-2xl p-6 border-2 border-yellow-200 dark:border-yellow-700 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
                    <div class="flex flex-col items-center justify-center h-full space-y-3">
                        <div class="relative glow-container glow-solar">
                            <div class="glow-ring"></div>
                            <div class="spinning-ring"></div>
                            <svg class="energy-icon" viewBox="0 0 100 100" id="pv-icon">
                                <circle cx="50" cy="50" r="20" fill="url(#solarGradient)" />
                                <g stroke="url(#solarGradient)" stroke-width="3" stroke-linecap="round">
                                    <line x1="50" y1="10" x2="50" y2="20" />
                                    <line x1="50" y1="80" x2="50" y2="90" />
                                    <line x1="10" y1="50" x2="20" y2="50" />
                                    <line x1="80" y1="50" x2="90" y2="50" />
                                    <line x1="21" y1="21" x2="29" y2="29" />
                                    <line x1="71" y1="71" x2="79" y2="79" />
                                    <line x1="21" y1="79" x2="29" y2="71" />
                                    <line x1="71" y1="29" x2="79" y2="21" />
                                </g>
                                <circle cx="50" cy="50" r="20" fill="none" stroke="#fbbf24" stroke-width="1" opacity="0.5">
                                    <animate attributeName="r" values="20;25;20" dur="2s" repeatCount="indefinite" />
                                    <animate attributeName="opacity" values="0.5;0.2;0.5" dur="2s" repeatCount="indefinite" />
                                </circle>
                                <defs>
                                    <radialGradient id="solarGradient">
                                        <stop offset="0%" stop-color="#fbbf24" />
                                        <stop offset="100%" stop-color="#f59e0b" />
                                    </radialGradient>
                                </defs>
                            </svg>
                            <div class="energy-particles">
                                <div class="particle" style="--particle-color: #fbbf24"></div>
                                <div class="particle" style="--particle-color: #fbbf24"></div>
                                <div class="particle" style="--particle-color: #fbbf24"></div>
                            </div>
                        </div>
                        <div class="text-center w-full">
                            <div class="text-sm font-semibold text-yellow-700 dark:text-yellow-300 mb-1">Solar PV</div>
                            <div class="text-2xl font-bold text-yellow-600 dark:text-yellow-300" id="pv-power">-</div>
                            <div class="text-xs text-gray-600 dark:text-gray-400 mt-1" id="pv-desc">-</div>
                        </div>
                    </div>
                </div>

                <!-- Device (Center) -->
                <div class="energy-card bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-700 rounded-2xl p-6 border-2 border-gray-300 dark:border-gray-600 shadow-lg">
                    <div class="flex flex-col items-center justify-center h-full space-y-3">
                        <div class="relative">
                            <svg class="energy-icon" viewBox="0 0 100 100">
                                <rect x="25" y="20" width="50" height="60" rx="5" fill="url(#inverterGradient)" stroke="#64748b" stroke-width="2" />
                                <rect x="32" y="28" width="36" height="20" rx="2" fill="#1e293b" />
                                <line x1="37" y1="35" x2="50" y2="35" stroke="#22c55e" stroke-width="2" />
                                <line x1="55" y1="35" x2="63" y2="35" stroke="#22c55e" stroke-width="2" />
                                <line x1="37" y1="41" x2="45" y2="41" stroke="#3b82f6" stroke-width="2" />
                                <line x1="50" y1="41" x2="63" y2="41" stroke="#3b82f6" stroke-width="2" />
                                <circle cx="35" cy="60" r="3" fill="#3b82f6" />
                                <circle cx="50" cy="60" r="3" fill="#22c55e" />
                                <circle cx="65" cy="60" r="3" fill="#ef4444" />
                                <g opacity="0.5">
                                    <line x1="30" y1="68" x2="70" y2="68" stroke="#64748b" stroke-width="1" />
                                    <line x1="30" y1="72" x2="70" y2="72" stroke="#64748b" stroke-width="1" />
                                    <line x1="30" y1="76" x2="70" y2="76" stroke="#64748b" stroke-width="1" />
                                </g>
                                <defs>
                                    <linearGradient id="inverterGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" stop-color="#cbd5e1" />
                                        <stop offset="100%" stop-color="#94a3b8" />
                                    </linearGradient>
                                </defs>
                            </svg>
                        </div>
                        <div class="text-center w-full">
                            <div class="text-xl font-bold text-gray-700 dark:text-gray-200" id="inverter-type">Inverter</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400 mt-1" id="device-temp">-</div>
                        </div>
                    </div>
                </div>

                <!-- Grid -->
                <div class="energy-card bg-gradient-to-br from-purple-50 to-indigo-100 dark:from-purple-900/30 dark:to-indigo-800/30 rounded-2xl p-6 border-2 border-purple-200 dark:border-purple-700 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
                    <div class="flex flex-col items-center justify-center h-full space-y-3">
                        <div class="relative glow-container glow-grid">
                            <div class="glow-ring"></div>
                            <div class="spinning-ring"></div>
                            <svg class="energy-icon" viewBox="0 0 100 100" id="grid-icon">
                                <path d="M 50 10 L 40 35 L 35 35 L 40 75 L 35 90 L 65 90 L 60 75 L 65 35 L 60 35 Z" 
                                      fill="url(#gridGradient)" stroke="#a855f7" stroke-width="2" />
                                <line x1="30" y1="35" x2="70" y2="35" stroke="#a855f7" stroke-width="2" />
                                <line x1="32" y1="55" x2="68" y2="55" stroke="#a855f7" stroke-width="2" />
                                <g stroke="#a855f7" stroke-width="1.5" opacity="0.6">
                                    <path d="M 30 35 Q 20 40 10 35" />
                                    <path d="M 70 35 Q 80 40 90 35" />
                                </g>
                                <circle cx="50" cy="25" r="3" fill="#fbbf24">
                                    <animate attributeName="r" values="3;5;3" dur="1s" repeatCount="indefinite" />
                                    <animate attributeName="opacity" values="1;0.5;1" dur="1s" repeatCount="indefinite" />
                                </circle>
                                <defs>
                                    <linearGradient id="gridGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" stop-color="#a855f7" />
                                        <stop offset="100%" stop-color="#7c3aed" />
                                    </linearGradient>
                                </defs>
                            </svg>
                        </div>
                        <div class="text-center w-full">
                            <div class="text-sm font-semibold text-purple-700 dark:text-purple-300 mb-1">Power Grid</div>
                            <div class="text-2xl font-bold text-purple-600 dark:text-purple-300" id="grid-power">-</div>
                            <div class="text-xs text-gray-600 dark:text-gray-400 mt-1" id="grid-voltage">-</div>
                        </div>
                    </div>
                </div>

                <!-- ROW 2: Battery, Essential Load, Home Load -->
                
                <!-- Battery -->
                <div class="energy-card bg-gradient-to-br from-green-50 to-emerald-100 dark:from-green-900/30 dark:to-emerald-800/30 rounded-2xl p-6 border-2 border-green-200 dark:border-green-700 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
                    <div class="flex flex-col items-center justify-center h-full space-y-3">
                        <div class="relative glow-container glow-battery">
                            <div class="glow-ring"></div>
                            <div class="spinning-ring"></div>
                            <svg class="energy-icon" viewBox="0 0 100 100" id="battery-icon">
                                <rect x="20" y="30" width="55" height="40" rx="5" fill="url(#batteryGradient)" stroke="#22c55e" stroke-width="2" />
                                <rect x="75" y="43" width="5" height="14" rx="2" fill="#22c55e" />
                                <rect x="25" y="35" width="0" height="30" rx="3" fill="#10b981" id="battery-fill-svg">
                                    <animate attributeName="width" values="0;45;0" dur="3s" repeatCount="indefinite" />
                                </rect>
                                <path d="M 42 38 L 38 50 L 45 50 L 40 62 L 52 48 L 45 48 L 50 38 Z" fill="#fbbf24" opacity="0.9">
                                    <animate attributeName="opacity" values="0.9;0.4;0.9" dur="1s" repeatCount="indefinite" />
                                </path>
                                <defs>
                                    <linearGradient id="batteryGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" stop-color="#22c55e" stop-opacity="0.2" />
                                        <stop offset="100%" stop-color="#10b981" stop-opacity="0.4" />
                                    </linearGradient>
                                </defs>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                <span class="text-white text-lg font-bold drop-shadow-lg" id="battery-percentage">-</span>
                            </div>
                        </div>
                        <div class="text-center w-full">
                            <div class="text-sm font-semibold text-green-700 dark:text-green-300 mb-1">Battery</div>
                            <div class="text-2xl font-bold text-green-600 dark:text-green-300" id="battery-power">-</div>
                        </div>
                    </div>
                </div>

                <!-- Essential Load -->
                <div class="energy-card bg-gradient-to-br from-orange-50 to-amber-100 dark:from-orange-900/30 dark:to-amber-800/30 rounded-2xl p-6 border-2 border-orange-200 dark:border-orange-700 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
                    <div class="flex flex-col items-center justify-center h-full space-y-3">
                        <div class="relative glow-container glow-essential">
                            <div class="glow-ring"></div>
                            <div class="spinning-ring"></div>
                            <svg class="energy-icon" viewBox="0 0 100 100" id="essential-icon">
                                <path d="M 50 15 L 55 40 L 80 45 L 58 60 L 65 85 L 50 70 L 35 85 L 42 60 L 20 45 L 45 40 Z" 
                                      fill="url(#essentialGradient)" stroke="#f97316" stroke-width="2" />
                                <circle cx="50" cy="50" r="15" fill="#fb923c" opacity="0.5">
                                    <animate attributeName="r" values="15;20;15" dur="2s" repeatCount="indefinite" />
                                    <animate attributeName="opacity" values="0.5;0.2;0.5" dur="2s" repeatCount="indefinite" />
                                </circle>
                                <circle cx="50" cy="50" r="5" fill="#fbbf24">
                                    <animate attributeName="r" values="5;7;5" dur="1s" repeatCount="indefinite" />
                                </circle>
                                <defs>
                                    <radialGradient id="essentialGradient">
                                        <stop offset="0%" stop-color="#fb923c" />
                                        <stop offset="100%" stop-color="#f97316" />
                                    </radialGradient>
                                </defs>
                            </svg>
                        </div>
                        <div class="text-center w-full">
                            <div class="text-sm font-semibold text-orange-700 dark:text-orange-300 mb-1">Essential</div>
                            <div class="text-2xl font-bold text-orange-600 dark:text-orange-300" id="essential-power">-</div>
                        </div>
                    </div>
                </div>

                <!-- Home Load -->
                <div class="energy-card bg-gradient-to-br from-red-50 to-rose-100 dark:from-red-900/30 dark:to-rose-800/30 rounded-2xl p-6 border-2 border-red-200 dark:border-red-700 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
                    <div class="flex flex-col items-center justify-center h-full space-y-3">
                        <div class="relative glow-container glow-load">
                            <div class="glow-ring"></div>
                            <div class="spinning-ring"></div>
                            <svg class="energy-icon" viewBox="0 0 100 100" id="load-icon">
                                <path d="M 50 15 L 20 40 L 20 85 L 80 85 L 80 40 Z" fill="url(#homeGradient)" stroke="#ef4444" stroke-width="2" />
                                <path d="M 15 40 L 50 10 L 85 40 L 80 40 L 50 18 L 20 40 Z" fill="#dc2626" />
                                <rect x="42" y="60" width="16" height="25" rx="2" fill="#991b1b" />
                                <rect x="30" y="50" width="12" height="12" rx="1" fill="#fbbf24" opacity="0.8">
                                    <animate attributeName="opacity" values="0.8;0.4;0.8" dur="2s" repeatCount="indefinite" />
                                </rect>
                                <rect x="58" y="50" width="12" height="12" rx="1" fill="#fbbf24" opacity="0.8">
                                    <animate attributeName="opacity" values="0.8;0.4;0.8" dur="2s" repeatCount="indefinite" begin="1s" />
                                </rect>
                                <rect x="65" y="22" width="8" height="18" fill="#7f1d1d" />
                                <circle cx="69" cy="18" r="2" fill="#94a3b8" opacity="0.6">
                                    <animate attributeName="cy" values="18;8;18" dur="3s" repeatCount="indefinite" />
                                    <animate attributeName="opacity" values="0.6;0;0.6" dur="3s" repeatCount="indefinite" />
                                </circle>
                                <defs>
                                    <linearGradient id="homeGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" stop-color="#fca5a5" stop-opacity="0.3" />
                                        <stop offset="100%" stop-color="#ef4444" stop-opacity="0.2" />
                                    </linearGradient>
                                </defs>
                            </svg>
                        </div>
                        <div class="text-center w-full">
                            <div class="text-sm font-semibold text-red-700 dark:text-red-300 mb-1">Home Load</div>
                            <div class="text-2xl font-bold text-red-600 dark:text-red-300" id="load-power">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
